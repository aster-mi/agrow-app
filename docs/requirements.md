# Agrow 要件定義書

## 目次
- [1. 概要](#1-概要)
- [2. 目的](#2-目的)
- [3. 対象ユーザー](#3-対象ユーザー)
- [4. プラットフォームと開発方針](#4-プラットフォームと開発方針)
- [5. 認証・ユーザープロフィール](#5-認証ユーザープロフィール)
- [6. 画像・ストレージ](#6-画像ストレージ)
- [7. アガベ管理機能](#7-アガベ管理機能)
  - [7.1 基本情報](#71-基本情報)
  - [7.2 親株・子株](#72-親株子株)
  - [7.3 棚管理](#73-棚管理)
- [8. NFC 連携](#8-nfc-連携)
- [9. タイムライン機能](#9-タイムライン機能)
- [10. タグ・検索](#10-タグ検索)
- [11. 通知](#11-通知)
  - [11.1 種別](#111-種別)
  - [11.2 表示](#112-表示)
  - [11.3 設定](#113-設定)
  - [11.4 実装](#114-実装)
- [12. オフライン対応と同期](#12-オフライン対応と同期)
- [13. 通報・セキュリティ](#13-通報セキュリティ)
- [14. オフライン同期 (NFC/棚データ等)](#14-オフライン同期-nfc棚データ等)
- [15. プッシュ通知以外のモバイル機能](#15-プッシュ通知以外のモバイル機能)
- [16. 多言語対応](#16-多言語対応)
- [17. 今後の拡張（Want / Future）](#17-今後の拡張want--future)
- [18. スケジュール](#18-スケジュール)
- [19. その他](#19-その他)

## 1. 概要
Agrow はアガベを中心とした植物管理・共有アプリです。Expo (Managed ワークフロー) を用いて Android/iOS 向けに開発します。本書はヒアリング結果をもとにした初期要件をまとめたものです。

## 2. 目的
- アガベの育成記録を簡単に残し、成長を可視化する。
- SNS 連携を通じて育成の楽しさを共有する。
- NFC や棚管理により実際の栽培環境とアプリを紐付け、管理の効率化を図る。
- 将来的な IoT 連携や課金プランにも拡張できる土台を用意する。

## 3. 対象ユーザー
- 主に X（旧 Twitter）や Instagram でアガベの写真を投稿している一般の植物趣味家。

## 4. プラットフォームと開発方針
- **プラットフォーム**: Android / iOS
- **開発フレームワーク**: Expo (Managed)
- **使用言語**: TypeScript / React Native (Expo)
- **データ基盤**: Supabase（Auth、DB、Storage、Edge Functions）
- **API スタイル**: REST

## 5. 認証・ユーザープロフィール
- Google 認証と X 認証をサポート。メール/パスワード認証は提供しない。
- 同一メールアドレスを用いる Google/X アカウントは同一ユーザーとして統合。
- プロフィール項目: ユーザー名、アイコン、自己紹介、フォロー／フォロワー。

## 6. 画像・ストレージ
- 画像は Supabase Storage に保存。
- 1ユーザーあたりの総容量上限: 500MB（将来的にプランにより拡張）。
- 容量超過時はアップロードを拒否し、有料プランへの誘導。
- 1枚あたりのサイズ制限は設けない。
- 画像には撮影日（必須）と任意メモをメタデータとして保持。
  - 撮影日は EXIF から自動取得し、存在しない場合は登録時刻を初期値とする。
  - ユーザーは撮影日を編集可能。

## 7. アガベ管理機能
### 7.1 基本情報
- 名称、画像（1枚以上）、タグなどを登録。空データは不可。
- 公開設定: **public / private** の2種。
  - 投稿は常に public。
  - private 株を共有する場合は画像のみ共有し、株へのリンクは生成しない。

### 7.2 親株・子株
- ユーザーが所有する株同士のみ親子紐付け可能。
- 親株画面から子株を追加、子株画面から親株を紐付け可能。
- 世代数に上限なし。

### 7.3 棚管理
- 複数棚を扱える。棚単位で列数（グリッド数）を設定可能。行数上限なし。
- 初期状態では自動配置し、ユーザーが後から場所を編集可能。
- 編集モードを明示的に切り替え、モード中は長押し＋ドラッグで位置入れ替え。
- 棚の並び順自体もユーザーが入れ替え可能。

## 8. NFC 連携
- 使用タグ: 周波数13.56MHz、ISO14443A、容量1KB EEPROM、書き換え10万回など。
- **リンク書き込みは必須**。タグへのリンクを発行し、株と紐付ける。
- タグ読み取りでアプリ起動。未起動でも直接該当株画面へ遷移することを想定。
- NFC読み取り後は株詳細画面へ直接遷移。読み取り履歴画面は別途用意。
- 履歴データは端末ローカルに保存。履歴件数に上限はないが、同一株は最新のみ保持。

## 9. タイムライン機能
- X に近い UI/UX を想定。
- 投稿内容: テキスト＋画像（最大4枚）。
- リアクション: いいね、コメント、リポスト(RT)。
- 投稿の削除・編集が可能。
- 無限スクロールで10件ずつ読み込み。キャッシュ期間の制限なし。
- 外部共有時の OGP:
  - 画像リンク: 画像 + 株名。
  - 株リンク: 代表画像 + 株名。

## 10. タグ・検索
- タグは全ユーザーで共有管理。
- タグ検索対象: 全ユーザーの **public 株**。自分の株に絞り込むフィルタあり。
- 複数タグで AND 検索をサポート（OR/NOT 検索の導入予定なし）。
- タグサジェスト（入力補助）は欲しい機能。
- タグ以外に株名・棚名などでも検索可能。結果は並び替え（更新日時／名称など）に対応。

## 11. 通知
### 11.1 種別
- いいね、リポスト、コメント、フォロー、水やりリマインダーなど。
- 優先順位は特になし。

### 11.2 表示
- 通知一覧は未読バッジによるシンプル表示。種別ごとのアイコン区分は不要。
- タイムライン上では X のような未読バッジ表示が理想だが、実装が複雑な場合は簡易版でも可。
- 返信やメンションに対しては専用のフィルタ表示を行う。

### 11.3 設定
- 通知設定画面を提供し、種別ごとの ON/OFF を切り替えられる。
- 通知タイミング（リアルタイム／まとめてなど）の設定はなし。

### 11.4 実装
- Expo Push Notifications を利用。

## 12. オフライン対応と同期
- オフライン時も閲覧・編集・投稿が可能。ローカルに一時保存し、オンライン復帰後に同期。
- 同期失敗時は最大3回まで自動リトライ。失敗後は管理者へメール通知。
- ユーザーには詳細を隠した簡易エラーメッセージのみ表示。
- エラー画面には手動で再試行できる「再試行」ボタンを配置。

## 13. 通報・セキュリティ
- 公開投稿に対する通報機能を用意。理由は自由記述。受理確認などのユーザーへのフィードバックは行わない。
- 通報内容は内部管理用メールに送信。
- 投稿および株情報の編集権限は所有者のみ。共同編集機能は想定しない。
- API アクセスのレート制限やロール設定は現時点で未実装。

## 14. オフライン同期 (NFC/棚データ等)
- NFC読み取り履歴や棚配置など、端末ローカルで保持するデータに明確な保存期間の制限は設けない。

## 15. プッシュ通知以外のモバイル機能
- 将来的に水やり通知などのリマインダーを実装。
- オフライン中の操作はトランザクション整合性を保てる範囲で許容。

## 16. 多言語対応
- 画面表示は当面 **日本語のみ** をサポート。多言語化は当面の予定なし。

## 17. 今後の拡張（Want / Future）
- 水やり通知。
- ユーザー間での株交換・譲渡機能。
- 購入情報（入手元、価格）の記録。
- 血統図の可視化。
- Stripe を用いた課金・料金プラン。
- IoT機器（湿度センサー・照度センサー等）との連携。

## 18. スケジュール
- 具体的なリリース時期は未定。
- MVPは上記 Must 要件が実装された段階でリリースとする。

## 19. その他
- ブランドイメージ: モダン。色やフォント等は今後定義。
- ワイヤーフレームは開発チームから提案する。
- データベースやストレージの増強が必要な場合は有料プランへ移行。

---
この要件定義書は初期のヒアリング内容を整理したものであり、今後の検討に応じて更新される可能性があります。
